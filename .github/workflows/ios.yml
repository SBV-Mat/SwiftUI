name: iOS starter workflow

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  build:
    name: Build and Test default scheme using any available iPhone simulator
    runs-on: macos-15

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      # Detect available schemes and set as variable
      - name: Set Default Scheme
        run: |
          scheme_list=$(xcodebuild -list -json | tr -d "\n")
          scheme=$(echo $scheme_list | ruby -e "require 'json'; puts JSON.parse(STDIN.gets)['project']['targets'][0]")
          echo $scheme | cat >scheme
          echo Using scheme: $scheme
      
      - uses: mxcl/xcodebuild@v1.9.2
        with:
          platform: 'iOS'
          action: 'test'

      # Run tests on iPhone 14 Simulator with iOS 16.0
      # - name: Run Tests on iPhone 15 Simulator (iOS 18.1)
      #   run: |
      #     xcodebuild test \
      #       -scheme ' $scheme ' \
      #       -destination 'platform=iOS Simulator,name=iPhone 15,OS=18.1'
